{% extends 'base/base.html' %}
{% load static %}
{% block contenido %}
    {% if not user.is_authenticated%}
        <div class="text-center py-3">
                <div class="row justify-content-md-center">
                    <div class="col steps">
                        <div class="step-circle"><i class="fa fa-check-circle text-success" aria-hidden="true"></i></div>
                        <div class="step-circle"><i class="fa fa-check-circle text-success" aria-hidden="true"></i></div>
                        <div class="step-circle"><i class="fa fa-check-circle text-success" aria-hidden="true"></i></div>
                        <div class="step-circle bg-success text-white">4</div>
                        <div class="step-circle">5</div>
                        <div class="step-circle">6</div>
                        <div class="step-circle">FIN</div>
                    </div>
                </div>
        </div>
        <div class="row">
            <div class="col">
                <div class="mb-3 row">
                    <div class="col-md-4 col-sm-12 fw-bold col-form-label">TIPO DE FINANCIAMIENTO</div>
                    <div class="col-md-8 col-sm-12 bg-white d-flex align-items-center border border-success-subtle">{{ fin }}</div>
                    <div class="col-md-4 col-sm-12 fw-bold col-form-label">DEPARTAMENTO</div>
                    <div class="col-md-8 col-sm-12 bg-white d-flex align-items-center border border-success-subtle">{{ dep }}</div>                
                    <div class="col-md-4 col-sm-12 fw-bold col-form-label">ENTIDAD TERRITORIAL AUTONOMA</div>
                    <div class="col-md-8 col-sm-12 bg-white d-flex align-items-center border border-success-subtle">{{ ent }}</div>                
                </div>
                <div class="row">
                    <h3 class="text-center text-bg-primary">SELECCIONE EL NOMBRE DE LA ENTIDAD EJECUTORIA</h3>
                    <!-- Buscador -->
                    <div class="mb-3">
                        <input type="text" id="buscadorMunicipios" class="form-control" placeholder="Buscar municipio...">
                    </div>
                    <div id="sinResultados" class="text-center text-danger mt-3" style="display: none;">
                        No se encontraron resultados.
                    </div>
                    <!-- Tarjetas -->
                    {% if object_list %}
                        <div class="row">
                            {% for municipios in object_list %}
                                <div class="col-sm-6 col-md-3 p-3 municipio-item">
                                    <a href="{% url 'solicitud:MAE' municipios.pk n_ent n_fin %}" style="text-decoration: none; color: inherit;">
                                        <div class="card bg-info-subtle">
                                            <div class="card-body">
                                                <h5 class="card-title text-center">{{ municipios.nombre_municipio }}</h5>
                                            </div>
                                        </div>
                                    </a>
                                </div> 
                            {% endfor %}
                        </div>
                    {% else %}
                        NO SE ENCONTRARON MUNICIPIOS
                    {% endif %}
                    
                </div>                
            </div>
        </div>
    {% endif %}

{% endblock contenido %}
{% block funcScript %}
<script>
    function normalizarTexto(texto) {
        return texto.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    document.addEventListener('DOMContentLoaded', function () {
        const input = document.getElementById('buscadorMunicipios');
        const tarjetas = document.querySelectorAll('.municipio-item');
        const mensajeSinResultados = document.getElementById('sinResultados');

        if (!input || tarjetas.length === 0) {
            console.warn("Elementos no encontrados");
            return;
        }

        input.addEventListener('input', function () {
            const filtro = normalizarTexto(this.value.trim());
            let hayResultados = false;

            tarjetas.forEach(tarjeta => {
                const titulo = normalizarTexto(tarjeta.querySelector('.card-title').textContent);
                const coincide = titulo.includes(filtro);
                tarjeta.style.display = coincide ? '' : 'none';
                if (coincide) hayResultados = true;
            });

            mensajeSinResultados.style.display = hayResultados ? 'none' : 'block';
        });
    });
</script>
{% endblock %}
